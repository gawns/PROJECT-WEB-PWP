{% extends "base.html" %}
{% block content %}
<div class="min-height-screen pt-5 pb-4 bg-dark">
    <div class="container">
        <div class="glass-panel animate__animated animate__fadeIn">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
                <div>
                    <h2 class="gold mb-1">
                        <i class="fa-solid fa-clipboard-list"></i> Manajemen Pesanan
                    </h2>
                    <p class="text-gray text-small">
                        {% if request.args.get('status') %}
                            Menampilkan kategori: <strong>{{ request.args.get('status')|upper }}</strong>
                        {% else %}
                            Menampilkan semua pesanan
                        {% endif %}
                        ({{ orders|length }})
                    </p>
                </div>
                
                <div class="d-flex gap-2 flex-wrap">
                    <a href="/admin/statistics" class="btn-outline">
                        <i class="fa-solid fa-chart-line"></i> Statistik
                    </a>
                    <a href="/admin" class="btn-gold">
                        <i class="fa-solid fa-arrow-left"></i> Dashboard
                    </a>
                </div>
            </div>

            <div class="d-flex flex-wrap gap-2 mb-4 filter-container">
                <a href="{{ url_for('admin_orders') }}" 
                   class="filter-tab {% if not request.args.get('status') %}active{% endif %}">
                    Semua
                </a>
                <a href="{{ url_for('admin_orders', status='pending') }}" 
                   class="filter-tab status-pending {% if request.args.get('status') == 'pending' %}active{% endif %}">
                    <i class="fa-solid fa-clock"></i> Pending
                </a>
                <a href="{{ url_for('admin_orders', status='diproses') }}" 
                   class="filter-tab status-processing {% if request.args.get('status') == 'diproses' %}active{% endif %}">
                    <i class="fa-solid fa-spinner"></i> Diproses
                </a>
                <a href="{{ url_for('admin_orders', status='dikirim') }}" 
                   class="filter-tab status-shipping {% if request.args.get('status') == 'dikirim' %}active{% endif %}">
                    <i class="fa-solid fa-truck"></i> Dikirim
                </a>
                <a href="{{ url_for('admin_orders', status='selesai') }}" 
                   class="filter-tab status-completed {% if request.args.get('status') == 'selesai' %}active{% endif %}">
                    <i class="fa-solid fa-check-circle"></i> Selesai
                </a>
            </div>

            <div class="responsive-table">
                <table>
                    <thead>
                        <tr>
                            <th>Kode</th>
                            <th>Pelanggan</th>
                            <th>Pesanan</th>
                            <th class="text-center">Qty</th>
                            <th class="text-right">Total</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td data-label="Kode">
                                <span class="order-code">{{ order.kode_pesanan }}</span>
                            </td>
                            <td data-label="Pelanggan">
                                <div>
                                    <strong>{{ order.username if order.username else 'Pelanggan Thury' }}</strong>
                                    <br>
                                    <small class="text-gray">{{ order.email }}</small>
                                </div>
                            </td>
                            <td data-label="Pesanan">
                                {{ order.menu_nama }}
                            </td>
                            <td data-label="Qty" class="text-center">
                                <span class="qty-badge">{{ order.quantity }}</span>
                            </td>
                            <td data-label="Total" class="text-right">
                                <strong class="gold">Rp {{ "{:,}".format(order.total_harga) }}</strong>
                            </td>
                            <td data-label="Status" class="text-center">
                                <form action="/admin/order/update_status/{{ order.id }}" method="POST">
                                    <select name="status" 
                                            class="status-select status-{{ order.status }}"
                                            onchange="this.form.submit()">
                                        <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                                        <option value="diproses" {% if order.status == 'diproses' %}selected{% endif %}>Diproses</option>
                                        <option value="dikirim" {% if order.status == 'dikirim' %}selected{% endif %}>Dikirim</option>
                                        <option value="selesai" {% if order.status == 'selesai' %}selected{% endif %}>Selesai</option>
                                    </select>
                                </form>
                            </td>
                            <td data-label="Aksi" class="text-center">
                                <button onclick="showOrderDetails({{ order.id }})" class="btn-icon">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% if not orders %}
            <div class="text-center p-5">
                <i class="fa-solid fa-inbox" style="font-size: 3rem; color: #333; margin-bottom: 15px;"></i>
                <h4 class="text-gray">Tidak ada pesanan dalam kategori ini</h4>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Styling khusus Tab yang Aktif */
    .filter-tab {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #333;
        border-radius: 50px;
        color: #888;
        font-weight: 600;
        transition: all 0.3s;
        text-decoration: none;
    }

    .filter-tab:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .filter-tab.active {
        background: var(--accent) !important;
        color: #000 !important;
        border-color: var(--accent) !important;
        box-shadow: 0 4px 15px rgba(255, 200, 0, 0.3);
    }

    /* Warna Status Select */
    .status-select {
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        background: #111;
        border: 1px solid #444;
    }

    .status-pending { color: #f39c12; border-color: #f39c12; }
    .status-diproses { color: #3498db; border-color: #3498db; }
    .status-dikirim { color: #9b59b6; border-color: #9b59b6; }
    .status-selesai { color: #2ecc71; border-color: #2ecc71; }
</style>
{% endblock %}  